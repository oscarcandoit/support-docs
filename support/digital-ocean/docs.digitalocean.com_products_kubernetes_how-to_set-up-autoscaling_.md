---
url: "https://docs.digitalocean.com/products/kubernetes/how-to/set-up-autoscaling/"
title: "Autoscale Cluster With Horizontal Pod Autoscaling | DigitalOcean Documentation"
---

- [DigitalOcean \| Docs](https://docs.digitalocean.com/)

- [Platform](https://docs.digitalocean.com/platform/)
- [Products](https://docs.digitalocean.com/products/)
- [Reference](https://docs.digitalocean.com/reference/)
- [Support](https://docs.digitalocean.com/support/)
- [Sign Up](https://cloud.digitalocean.com/registrations/new)

- [![](https://docs.digitalocean.com/images/icons/kubernetes.5c9f5538fc3c9db4ddd19b3b4c2166c4e06a899c3582345cc892b570bd214072.svg)Kubernetes](https://docs.digitalocean.com/products/kubernetes/)
- [Getting Started](https://docs.digitalocean.com/products/kubernetes/getting-started/)
  - [Quickstart](https://docs.digitalocean.com/products/kubernetes/getting-started/quickstart/)
  - [Deploy Image to Cluster](https://docs.digitalocean.com/products/kubernetes/getting-started/deploy-image-to-cluster/)
  - [Set Up Operational Readiness](https://docs.digitalocean.com/products/kubernetes/getting-started/operational-readiness/)
- [How-Tos](https://docs.digitalocean.com/products/kubernetes/how-to/)
  - [Create Clusters](https://docs.digitalocean.com/products/kubernetes/how-to/create-clusters/)
  - [Connect to a Cluster](https://docs.digitalocean.com/products/kubernetes/how-to/connect-to-cluster/)
  - [Add Node Pools](https://docs.digitalocean.com/products/kubernetes/how-to/add-node-pools/)
  - [Enable Autoscaling](https://docs.digitalocean.com/products/kubernetes/how-to/autoscale/)
  - [Configure Multi-Node GPU Nodes](https://docs.digitalocean.com/products/kubernetes/how-to/configure-multinode-gpus/)
  - [Manage 1-Click Apps](https://docs.digitalocean.com/products/kubernetes/how-to/manage-1click-apps/)
  - [Back Up Managed Kubernetes Resources](https://docs.digitalocean.com/products/snapshooter/how-to/back-up-doks/)
  - [Destroy Clusters](https://docs.digitalocean.com/products/kubernetes/how-to/destroy-clusters/)
  - [Enable High Availability](https://docs.digitalocean.com/products/kubernetes/how-to/enable-high-availability/)
  - [Integrate with Container Registry](https://docs.digitalocean.com/products/kubernetes/how-to/integrate-with-docr/)
  - [Add Volumes](https://docs.digitalocean.com/products/kubernetes/how-to/add-volumes/)
  - [Delete Volumes](https://docs.digitalocean.com/products/kubernetes/how-to/delete-volumes/)
  - [Restore Volumes](https://docs.digitalocean.com/products/kubernetes/how-to/restore-volumes/)
  - [Use NFS Storage](https://docs.digitalocean.com/products/kubernetes/how-to/use-nfs-storage/)
  - [Import DigitalOcean Snapshots](https://docs.digitalocean.com/products/kubernetes/how-to/import-snapshot/)
  - [Create Snapshots](https://docs.digitalocean.com/products/kubernetes/how-to/create-snapshots/)
  - [Add Load Balancers](https://docs.digitalocean.com/products/kubernetes/how-to/add-load-balancers/)
  - [Configure Load Balancers](https://docs.digitalocean.com/products/kubernetes/how-to/configure-load-balancers/)
  - [Migrate Load Balancers](https://docs.digitalocean.com/products/kubernetes/how-to/migrate-load-balancers/)
  - [Delete Load Balancers](https://docs.digitalocean.com/products/kubernetes/how-to/delete-load-balancers/)
  - [Use Routing Agent](https://docs.digitalocean.com/products/kubernetes/how-to/use-routing-agent/)
  - [Use Spaces](https://docs.digitalocean.com/products/kubernetes/how-to/use-spaces/)
  - [Customize Cluster DNS Settings](https://docs.digitalocean.com/products/kubernetes/how-to/customize-coredns/)
  - [Enable Push-to-Deploy](https://docs.digitalocean.com/products/kubernetes/how-to/deploy-using-github-actions/)
  - [View Basic Metrics](https://docs.digitalocean.com/products/kubernetes/how-to/monitor-basic/)
  - [Use Cilium Hubble](https://docs.digitalocean.com/products/kubernetes/how-to/use-cilium-hubble/)
  - [Set Up Advanced Monitoring](https://docs.digitalocean.com/products/kubernetes/how-to/monitor-advanced/)
  - [Forward Logs](https://docs.digitalocean.com/products/kubernetes/how-to/forward-logs/)
  - [Upgrade Clusters](https://docs.digitalocean.com/products/kubernetes/how-to/upgrade-cluster/)
  - [Add Control Plane Firewallsprivate](https://docs.digitalocean.com/products/kubernetes/how-to/add-control-plane-firewall/)
  - [Set RoleBindings for Custom Roles](https://docs.digitalocean.com/products/kubernetes/how-to/set-up-custom-rolebindings/)
  - [Set Up Horizontal Pod Autoscaling](https://docs.digitalocean.com/products/kubernetes/how-to/set-up-autoscaling/)
- [Reference](https://docs.digitalocean.com/products/kubernetes/reference/)
  - [API Reference](https://docs.digitalocean.com/reference/api/digitalocean/#tag/Kubernetes)
  - [CLI Reference](https://docs.digitalocean.com/reference/doctl/reference/kubernetes/cluster/)
- [Concepts](https://docs.digitalocean.com/products/kubernetes/concepts/)
  - [Choosing a Plan](https://docs.digitalocean.com/products/kubernetes/concepts/choosing-a-plan/)
  - [Best Practices](https://docs.digitalocean.com/products/kubernetes/concepts/best-practices/)
- [Details](https://docs.digitalocean.com/products/kubernetes/details/)
  - [Features](https://docs.digitalocean.com/products/kubernetes/details/features/)
  - [Pricing](https://docs.digitalocean.com/products/kubernetes/details/pricing/)
  - [Availability](https://docs.digitalocean.com/products/kubernetes/details/availability/)
  - [Limits](https://docs.digitalocean.com/products/kubernetes/details/limits/)
  - [Changelog](https://docs.digitalocean.com/products/kubernetes/details/changelog/)
  - [Managed Kubernetes](https://docs.digitalocean.com/products/kubernetes/details/managed/)
  - [GPU Worker Nodes](https://docs.digitalocean.com/products/kubernetes/details/supported-gpus/)
  - [Security Information](https://docs.digitalocean.com/products/kubernetes/details/security/)
  - [Service-Level Agreement](https://www.digitalocean.com/sla/doks)
  - [Supported Releases](https://docs.digitalocean.com/products/kubernetes/details/supported-releases/)
  - [Volume Features](https://docs.digitalocean.com/products/kubernetes/details/volume-features/)
- [Support](https://docs.digitalocean.com/products/kubernetes/support/)

- [How-Tos](https://docs.digitalocean.com/products/kubernetes/how-to/)
- Set Up Horizontal Pod Autoscaling

[Give Feedback](https://ideas.digitalocean.com/documentation)

# Autoscale Cluster With Horizontal Pod Autoscaling

Validated on 19 Jul 2021 • Last edited on 17 Apr 2025

DigitalOcean Kubernetes (DOKS) is a Kubernetes service with a fully managed control plane, high availability, and autoscaling. DOKS integrates with standard Kubernetes toolchains and DigitalOcean’s load balancers, volumes, CPU and GPU Droplets, API, and CLI.

[Cluster Autoscaling (CA)](https://docs.digitalocean.com/products/kubernetes/how-to/autoscale/) manages the number of nodes in a cluster. It monitors the number of idle pods, or unscheduled pods sitting in the `pending` state, and uses that information to determine the appropriate cluster size.

[Horizontal Pod Autoscaling (HPA)](https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/) adds more pods and replicas based on events like sustained CPU spikes. HPA uses the spare capacity of the existing nodes and does not change the cluster’s size.

CA and HPA can work in conjunction: if the HPA attempts to schedule more pods than the current cluster size can support, then the CA responds by increasing the cluster size to add capacity. These tools can take the guesswork out of estimating the needed capacity for workloads while controlling costs and managing cluster performance.

In this tutorial, you deploy an example application that simulates workloads so you can see how the interaction between the CA and the HPA works, both when scaling up in response to demand and scaling down as load decreases.

Note
Autoscaling works best with stateless applications with multiple instances of the application accepting traffic in parallel. We do not recommend using this tutorial’s autoscaling strategy for more complex processes. For example, for processes such as database autoscaling, this strategy cannot account for race conditions, data integrity, data synchronization, and constant additions and removals of database cluster members.

## Prerequisites

To run the example application, you need to set up two tools:

1. [Install `doctl`](https://github.com/digitalocean/doctl), the DigitalOcean command-line tool, v1.32.2 or higher.

2. [Install `kubectl`](https://kubernetes.io/docs/tasks/tools/install-kubectl/), the Kubernetes command-line tool.


## Set Up Autoscaling-Enabled Cluster

You can [enable autoscaling](https://docs.digitalocean.com/products/kubernetes/how-to/autoscale/) on an existing cluster for this tutorial.

Alternatively, once you have `doctl` and `kubectl`, create a new DigitalOcean Kubernetes cluster with autoscaling enabled:

```shell
doctl k8s cluster create mycluster \
    --node-pool "name=mypool;auto-scale=true;min-nodes=1;max-nodes=10"
```

## Install Metrics Server Tool

Install the [DigitalOcean Kubernetes metrics server tool](https://marketplace.digitalocean.com/apps/kubernetes-metrics-server) from the DigitalOcean Marketplace so the HPA can monitor the cluster’s resource usage. Confirm that the metrics server is installed using the following command:

```shell
kubectl top nodes
```

It takes a few minutes for the metrics server to start reporting the metrics. If your installation is successful, the command returns your pods’ CPU and memory statistics:

Output

```
NAME           CPU(cores)   CPU%   MEMORY(bytes)   MEMORY%
mypool-3z4hs   369m         36%    783Mi           49%
mypool-3z4tz   84m          8%     791Mi           50%
mypool-3z520   425m         42%    917Mi           58%
mypool-3z52d   341m         34%    937Mi           59%
mypool-3zhiq   324m         32%    856Mi           54%
```

## Install CPU-spiking Service and HPA

Deploy the CPU-spiking service and the HPA itself by using [`hpa.yaml`](https://docs.digitalocean.com/products/kubernetes/how-to/set-up-autoscaling/hpa.yaml), which defines a custom resource definition (CRD) for an HPA configured to scale to up to 20 replicas of any service on the cluster that experiences a CPU spike at or above 80%:

```shell
kubectl apply -f <path-to-hpa-yaml-file>
```

## Test Autoscaling

Test the autoscaling behavior by scheduling the load generator using [`load-generator.yaml`](https://docs.digitalocean.com/products/kubernetes/how-to/set-up-autoscaling/load-generator.yaml), which repeatedly sends requests to the CPU-spiking service:

```shell
kubectl apply -f <path-to-load-generator-yaml-file>
```

As the load generator runs, you can check the status of the HPA and CA:

```shell
kubectl describe hpa hello # Check HPA status
kubectl get configmap cluster-autoscaler-status -n kube-system -oyaml # Check CA status
```

Continue checking the status of the HPA and CA. You can apply pressure to the cluster capacity by scaling up the load generator:

```shell
kubectl scale deployment/load-generator --replicas 2
```

After 5 minutes of sustained CPU spiking, the HPA starts scheduling more and more pods. Another 5 minutes after that, when the cluster runs out of capacity and the unscheduled pods start piling up, the CA kicks in to add more nodes.

Conversely, you can scale down the load generator and watch the number of pods decrease in your workload:

```shell
kubectl scale deployment/load-generator --replicas 1
```

After 5 minutes of lowered CPU use, the HPA starts to delete unutilized pods. Another 5 minutes after that, the CA notices the excess capacity and begins scaling down the number of nodes in the cluster as well.

## Next Steps

In this tutorial, you repeatedly sent CPU spikes to a DigitalOcean Kubernetes cluster and tested autoscaling both when scaling up in response to demand and scaling down as load decreased.

You can customize many parts of this example’s configuration, including the kinds of events that trigger an action from the HPA and how long they need to last to trigger a response. In general, you need to configure the HPA to balance responsiveness (being sensitive enough for timely responses to load changes) against thrashing (being too sensitive and causing wild fluctuations). For more details on configuring HPAs, see [Horizontal Pod Autoscaler in the Kubernetes documentation](https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/).

In this article...

- [Prerequisites](https://docs.digitalocean.com/products/kubernetes/how-to/set-up-autoscaling/#prerequisites)
- [Set Up Autoscaling-Enabled Cluster](https://docs.digitalocean.com/products/kubernetes/how-to/set-up-autoscaling/#set-up-autoscaling-enabled-cluster)
- [Install Metrics Server Tool](https://docs.digitalocean.com/products/kubernetes/how-to/set-up-autoscaling/#install-metrics-server-tool)
- [Install CPU-spiking Service and HPA](https://docs.digitalocean.com/products/kubernetes/how-to/set-up-autoscaling/#install-cpu-spiking-service-and-hpa)
- [Test Autoscaling](https://docs.digitalocean.com/products/kubernetes/how-to/set-up-autoscaling/#test-autoscaling)
- [Next Steps](https://docs.digitalocean.com/products/kubernetes/how-to/set-up-autoscaling/#next-steps)

##### Company

- [About](https://www.digitalocean.com/about)
- [Careers](https://www.digitalocean.com/careers)
- [Blog](https://www.digitalocean.com/blog)

##### Docs

- [Docs Home](https://docs.digitalocean.com/)
- [API Reference](https://docs.digitalocean.com/reference/api)
- [CLI Reference](https://docs.digitalocean.com/reference/doctl)
- [Release Notes](https://docs.digitalocean.com/release-notes)
- [Trust Platform](https://www.digitalocean.com/trust)

##### Community

- [Tutorials](https://www.digitalocean.com/community/tutorials)
- [Q&A](https://www.digitalocean.com/community/questions)
- [Write for DOnations](https://www.digitalocean.com/community/pages/write-for-digitalocean)
- [Currents Research](https://www.digitalocean.com/currents)
- [Legal](https://www.digitalocean.com/legal)
- [Code of Conduct](https://www.digitalocean.com/community/pages/code-of-conduct)

##### Support

- [Support Center](https://docs.digitalocean.com/support)
- [Report Abuse](https://www.digitalocean.com/company/contact/abuse)

* * *

Cookie Preferences

© 2025 DigitalOcean, LLC. All rights reserved

### We can't find any results for your search.

Try using different keywords or simplifying your search terms.

Loading...

## Product Docs

### We can't find any results for your search.

Try using different keywords or simplifying your search terms.

## Marketplace

## DigitalOcean Blog

## Community

navigategoexit

This site uses cookies and related technologies, as described in our [privacy policy](https://www.digitalocean.com/legal/privacy-policy/), for purposes that may include site operation, analytics, enhanced user experience, or advertising. You may choose to consent to our use of these technologies, or manage your own preferences. Please visit our [cookie policy](https://www.digitalocean.com/legal/cookie-policy) for more information.

Agree & ProceedDecline AllManage Choices

GenAI Agent - DigitalOcean

![DigitalOcean Docs Agent](https://product-docs.nyc3.cdn.digitaloceanspaces.com/ai-agent-icon.svg)