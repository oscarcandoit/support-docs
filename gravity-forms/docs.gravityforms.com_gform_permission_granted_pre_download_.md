---
url: "https://docs.gravityforms.com/gform_permission_granted_pre_download/"
title: "gform_permission_granted_pre_download - Gravity Forms"
---

[![Gravity Forms Documentation](https://docs.gravityforms.com/wp-content/uploads/2023/09/logo.svg)](https://docs.gravityforms.com/) [![Gravity Forms Documentation](https://docs.gravityforms.com/wp-content/uploads/2024/08/gf-print_logo.svg)](https://docs.gravityforms.com/)

- [User Guides](https://docs.gravityforms.com/category/user-guides/)
- [Developer](https://docs.gravityforms.com/category/developers/)
- [Blog](https://www.gravityforms.com/blog/)
- [Changelog](https://docs.gravityforms.com/gravityforms-change-log/)

```

```

Toggle Menu

- [Getting Started](https://docs.gravityforms.com/category/getting-started/)
- [Your Gravity Forms Account](https://docs.gravityforms.com/category/your-gravity-forms-account/)
- [User Guides](https://docs.gravityforms.com/category/user-guides/)
- [Gravity Forms 2.9](https://docs.gravityforms.com/category/gravity-forms-2-9/)
- [Gravity Forms 2.8](https://docs.gravityforms.com/category/gravity-forms-2-8/)
- [Add-Ons](https://docs.gravityforms.com/category/add-ons-gravity-forms/)
- [Developers](https://docs.gravityforms.com/category/developers/)  - [Theme Framework](https://docs.gravityforms.com/category/developers/theme-framework/)
  - [Hooks](https://docs.gravityforms.com/category/developers/hooks/)    - [Actions](https://docs.gravityforms.com/category/developers/hooks/actions/)
    - [Filters](https://docs.gravityforms.com/category/developers/hooks/filters/)      - [Add-On Framework Filters](https://docs.gravityforms.com/category/developers/hooks/filters/addon-framework-filters/)
      - [Add-On Filters](https://docs.gravityforms.com/category/developers/hooks/filters/filters-addons/)
      - [Admin Dashboard Filters](https://docs.gravityforms.com/category/developers/hooks/filters/admin-dashboard-filters/)
      - [Calculation Filters](https://docs.gravityforms.com/category/developers/hooks/filters/calculation-filters/)
      - [Conditional Logic Filters](https://docs.gravityforms.com/category/developers/hooks/filters/conditional-logic-filters/)
      - [Confirmation Filters](https://docs.gravityforms.com/category/developers/hooks/filters/confirmation-filters/)
      - [Editor Filters](https://docs.gravityforms.com/category/developers/hooks/filters/editor-filters/)
      - [Entry List Filters](https://docs.gravityforms.com/category/developers/hooks/filters/entry-list-filters/)
      - [Entry Filters](https://docs.gravityforms.com/category/developers/hooks/filters/entry-filters/)
      - [Field Filters](https://docs.gravityforms.com/category/developers/hooks/filters/field-filters/)        - [Image Choice Fields](https://docs.gravityforms.com/category/developers/hooks/filters/field-filters/image-choice-fields/)
        - [List Fields](https://docs.gravityforms.com/category/developers/hooks/filters/field-filters/list-fields/)
        - [Address Fields](https://docs.gravityforms.com/category/developers/hooks/filters/field-filters/address-fields/)
        - [Credit Card Fields](https://docs.gravityforms.com/category/developers/hooks/filters/field-filters/credit-card-fields/)
        - [Date Fields](https://docs.gravityforms.com/category/developers/hooks/filters/field-filters/date-fields/)
        - [Email Fields](https://docs.gravityforms.com/category/developers/hooks/filters/field-filters/email-filters/)
        - [File Upload Fields](https://docs.gravityforms.com/category/developers/hooks/filters/field-filters/file-upload-fields/)          - [gform\_cleanup\_target\_dir](https://docs.gravityforms.com/gform_cleanup_target_dir/ "gform_cleanup_target_dir")
          - [gform\_field\_types\_delete\_files](https://docs.gravityforms.com/gform_field_types_delete_files/ "gform_field_types_delete_files")
          - [gform\_file\_path\_pre\_delete\_file](https://docs.gravityforms.com/gform_file_path_pre_delete_file/ "gform_file_path_pre_delete_file")
          - [gform\_file\_permission](https://docs.gravityforms.com/gform_file_permission/ "gform_file_permission")
          - [gform\_file\_upload\_markup](https://docs.gravityforms.com/gform_file_upload_markup/ "gform_file_upload_markup")
          - [gform\_file\_upload\_whitelisting\_disabled](https://docs.gravityforms.com/gform_file_upload_whitelisting_disabled/ "gform_file_upload_whitelisting_disabled")
          - [gform\_fileupload\_entry\_value\_file\_path](https://docs.gravityforms.com/gform_fileupload_entry_value_file_path/ "gform_fileupload_entry_value_file_path")
          - [gform\_multifile\_upload\_field](https://docs.gravityforms.com/gform_multifile_upload_field/ "gform_multifile_upload_field")
          - [gform\_permission\_granted\_pre\_download](https://docs.gravityforms.com/gform_permission_granted_pre_download/ "gform_permission_granted_pre_download")
          - [gform\_plupload\_settings](https://docs.gravityforms.com/gform_plupload_settings/ "gform_plupload_settings")
          - [gform\_require\_login\_pre\_download](https://docs.gravityforms.com/gform_require_login_pre_download/ "gform_require_login_pre_download")
          - [gform\_secure\_file\_download\_is\_https](https://docs.gravityforms.com/gform_secure_file_download_is_https/ "gform_secure_file_download_is_https")
          - [gform\_secure\_file\_download\_location](https://docs.gravityforms.com/gform_secure_file_download_location/ "gform_secure_file_download_location")
          - [gform\_secure\_file\_download\_url](https://docs.gravityforms.com/gform_secure_file_download_url/ "gform_secure_file_download_url")
          - [gform\_submission\_files\_pre\_save\_field\_value](https://docs.gravityforms.com/gform_submission_files_pre_save_field_value/ "gform_submission_files_pre_save_field_value")
          - [gform\_temp\_file\_expiration\_days](https://docs.gravityforms.com/gform_temp_file_expiration_days/ "gform_temp_file_expiration_days")
          - [gform\_upload\_path](https://docs.gravityforms.com/gform_upload_path/ "gform_upload_path")
        - [Multiselect Fields](https://docs.gravityforms.com/category/developers/hooks/filters/field-filters/multiselect-fields/)
        - [Name Fields](https://docs.gravityforms.com/category/developers/hooks/filters/field-filters/name-fields/)
        - [Other Fields](https://docs.gravityforms.com/category/developers/hooks/filters/field-filters/other-fields/)
        - [Password Fields](https://docs.gravityforms.com/category/developers/hooks/filters/field-filters/password-fields/)
        - [Product Fields](https://docs.gravityforms.com/category/developers/hooks/filters/field-filters/product-fields/)
        - [gform\_checkbox\_choices](https://docs.gravityforms.com/gform_checkbox_choices/ "gform_checkbox_choices")
        - [gform\_choices\_setting\_title](https://docs.gravityforms.com/gform_choices_setting_title/ "gform_choices_setting_title")
        - [gform\_field\_choices](https://docs.gravityforms.com/gform_field_choices/ "gform_field_choices")
        - [gform\_field\_container](https://docs.gravityforms.com/gform_field_container/ "gform_field_container")
        - [gform\_field\_content](https://docs.gravityforms.com/gform_field_content/ "gform_field_content")
        - [gform\_field\_input](https://docs.gravityforms.com/gform_field_input/ "gform_field_input")
        - [gform\_field\_type\_title](https://docs.gravityforms.com/gform_field_type_title/ "gform_field_type_title")
        - [gform\_get\_input\_value](https://docs.gravityforms.com/gform_get_input_value/ "gform_get_input_value")
        - [gform\_save\_field\_value](https://docs.gravityforms.com/gform_save_field_value/ "gform_save_field_value")
        - [gform\_trim\_input\_value](https://docs.gravityforms.com/gform_trim_input_value/ "gform_trim_input_value")
      - [Field Framework Filters](https://docs.gravityforms.com/category/developers/hooks/filters/field-framework-filters/)
      - [Form Component Filters](https://docs.gravityforms.com/category/developers/hooks/filters/form-component-filters/)
      - [Form List Filters](https://docs.gravityforms.com/category/developers/hooks/filters/form-list/)
      - [Form Object Filters](https://docs.gravityforms.com/category/developers/hooks/filters/form-object/)
      - [Form Settings Filters](https://docs.gravityforms.com/category/developers/hooks/filters/form-settings-filters/)
      - [Import/Export Filters](https://docs.gravityforms.com/category/developers/hooks/filters/importexport-filters/)
      - [Logging Filters](https://docs.gravityforms.com/category/developers/hooks/filters/logging/)
      - [Merge Tag Filters](https://docs.gravityforms.com/category/developers/hooks/filters/merge-tags/)
      - [Notification Filters](https://docs.gravityforms.com/category/developers/hooks/filters/notification-filters/)
      - [Payment Filters](https://docs.gravityforms.com/category/developers/hooks/filters/payment/)
      - [Post Creation Filters](https://docs.gravityforms.com/category/developers/hooks/filters/post-creation/)
      - [REST API v1 Filters](https://docs.gravityforms.com/category/developers/hooks/filters/rest-api-v1/)
      - [REST API v2 Filters](https://docs.gravityforms.com/category/developers/hooks/filters/rest-api-v2/)
      - [Rich Text Editor Filters](https://docs.gravityforms.com/category/developers/hooks/filters/rich-text-editor/)
      - [Save and Continue Filters](https://docs.gravityforms.com/category/developers/hooks/filters/save-and-continue/)
      - [Script Filters](https://docs.gravityforms.com/category/developers/hooks/filters/script-filters/)
      - [Styling/Theme/CSS Filters](https://docs.gravityforms.com/category/developers/hooks/filters/styling-filters/)
      - [System Status Filters](https://docs.gravityforms.com/category/developers/hooks/filters/system-status/)
      - [Upload Filters](https://docs.gravityforms.com/category/developers/hooks/filters/upload-filters/)
      - [Validation Filters](https://docs.gravityforms.com/category/developers/hooks/filters/validation/)
    - [JavaScript](https://docs.gravityforms.com/category/developers/hooks/javascript/)
    - [Deprecated](https://docs.gravityforms.com/category/developers/hooks/deprecated/)
  - [Data Objects](https://docs.gravityforms.com/category/developers/data-objects/)
  - [PHP API](https://docs.gravityforms.com/category/developers/php-api/)
  - [Database](https://docs.gravityforms.com/category/developers/database/)
  - [Developer Snippets](https://docs.gravityforms.com/category/developers/tutorials/)
  - [REST API](https://docs.gravityforms.com/category/developers/rest-api/)
- [Knowledge Base](https://docs.gravityforms.com/category/knowledge-base/)

# gform\_permission\_granted\_pre\_download

- [Description](https://docs.gravityforms.com/gform_permission_granted_pre_download/#h-description)
- [Usage](https://docs.gravityforms.com/gform_permission_granted_pre_download/#h-usage)
- [Examples](https://docs.gravityforms.com/gform_permission_granted_pre_download/#h-examples)
- [Require the user to have administrative capabilities](https://docs.gravityforms.com/gform_permission_granted_pre_download/#h-require-the-user-to-have-administrative-capabilities)
- [Validate hash using older salt](https://docs.gravityforms.com/gform_permission_granted_pre_download/#h-validate-hash-using-older-salt)
- [Restrict access based on the visitor IP address](https://docs.gravityforms.com/gform_permission_granted_pre_download/#h-restrict-access-based-on-the-visitor-ip-address)
- [Placement](https://docs.gravityforms.com/gform_permission_granted_pre_download/#h-placement)
- [Since](https://docs.gravityforms.com/gform_permission_granted_pre_download/#h-since)
- [Source Code](https://docs.gravityforms.com/gform_permission_granted_pre_download/#h-source-code)

## Description

By default the real location of an uploaded file is hidden. The download URL will be generated with a security token to prevent guessing or enumeration attacks to discover the location of other files. The gform\_permission\_granted\_pre\_download filter can be used to perform custom logic to determine if the download URL will allow access to the file.

## Usage

The following would apply to all forms.

|     |
| --- |
| `add_filter(``'gform_permission_granted_pre_download'``,``'your_function_name'``, 10, 3 );` |

## Parameters

- **$permission\_granted** [bool](https://docs.gravityforms.com/bool)
Does the user have permission to access the file? Default is the result of the hash validation.

- **$form\_id** [int](https://docs.gravityforms.com/int)

The ID of the form used to upload the requested file.

- **$field\_id** [int](https://docs.gravityforms.com/int)

The ID of the field used to upload the requested file.


## Examples

### Require the user to have administrative capabilities

The following example shows how you can restrict access to only those users who have permission to activate plugins, but only when the hash has passed validation.

|     |     |
| --- | --- |
| 1<br>2<br>3 | `add_filter(``'gform_permission_granted_pre_download'``,``function``(``$permission_granted``,``$form_id``,``$field_id``) {`<br>`return``$permission_granted``&& current_user_can(``'activate_plugins'``);`<br>`}, 10, 3 );` |

### Validate hash using older salt

If the site salts change, the hash used to validate access to older files via links found in notification emails will fail validation. This example shows how you can revalidate the hash using the older salt.

|     |     |
| --- | --- |
| 1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16 | `add_filter(``'gform_permission_granted_pre_download'``,``function``(``$permission_granted``,``$form_id``,``$field_id``) {`<br>```if``(``$permission_granted``) {`<br>```return``$permission_granted``;`<br>```}`<br>```add_filter(``'salt'``,``'filter_salt_for_old_gf_download'``, 10, 2 );`<br>```$hash_check``= GFCommon::generate_download_hash(``$form_id``,``$field_id``, rgget(``'gf-download'``) );`<br>```remove_filter(``'salt'``,``'filter_salt_for_old_gf_download'``);`<br>```return``hash_equals( rgget(``'hash'``),``$hash_check``);`<br>`}, 10, 3 );`<br>`// Callback for the salt filter used with gform_permission_granted_pre_download.`<br>`function``filter_salt_for_old_gf_download(``$salt``,``$scheme``) {`<br>```return``'the-old-salt-here'``;`<br>`}` |

### Restrict access based on the visitor IP address

This example shows how you can restrict the access to gf-download links based on the visitor IP address. The example assumes your server is storing the visitor IP address in $\_SERVER\[‘REMOTE\_ADDR’\], this is the most common scenario, but it can be different for your server setup. Ask your web host support if you are not sure about this.

|     |     |
| --- | --- |
| 1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22 | `add_filter(``'gform_permission_granted_pre_download'``,``function``(``$permission_granted``,``$form_id``,``$field_id``) {`<br>```GFCommon::log_debug(``__METHOD__``.``'(): Runngin IP based gf-download restriction...'``);`<br>```$allowed_ips``=``array``(``// List of IP addresses allowed to access gf-download links.`<br>```'replace_this_with_your_ip'``,`<br>```'replace_this_with_another_ip'``,`<br>```'replace_this_with_another_ip'``,`<br>```);`<br>```GFCommon::log_debug(``__METHOD__``.``'(): Allowed IPs: '``. print_r(``$allowed_ips``, true ) );`<br>```// The snippet assumes your server stores the visitor IP in $_SERVER['REMOTE_ADDR'].`<br>```// Not all servers do this. Ask your web host support if you are not sure.`<br>```$visitor_ip``=``$_SERVER``[``'REMOTE_ADDR'``];`<br>```GFCommon::log_debug(``__METHOD__``.``'(): Visitor IP: '``.``$visitor_ip``);`<br>```if``( ! in_array(``$visitor_ip``,``$allowed_ips``) ) {`<br>```GFCommon::log_debug(``__METHOD__``.``'(): Visitor is not allowed to access gf-download links!'``);`<br>```wp_die(``'<p>You are <b>not allowed</b> to access download links for this site.</p>'``);``// Access not allowed if the IP is not in $allowed_ips.`<br>```}`<br>```return``$permission_granted``;`<br>`}, 10, 3 );` |

## Placement

This code should be placed in the [functions.php](http://codex.wordpress.org/Theme_Development#Functions_File) file of your active theme or a custom functions plugin.

## Since

This filter was added in Gravity Forms 2.4.3.2.

## Source Code

This filter is located in GF\_Download::maybe\_process() in _includes/class-gf-download.php_.

- Phone


This field is for validation purposes and should be left unchanged.

- Was this article helpful?

- How we can improve it?

- Please [open a support ticket](https://www.gravityforms.com/open-support-ticket/) if you need technical support or want to report a bug. Product feedback, feature and integration requests, and other functionality ideas can be submitted on our [Product Roadmap page](https://www.gravityforms.com/gravity-forms-roadmap/?c=submit-idea).


Δ

Last modified: March 21, 2024

© Copyright 2008 - 2025 Rocketgenius, Inc

[Return to Gravity Forms](https://www.gravityforms.com/)

Notifications

[Algolia](https://docs.gravityforms.com/gform_permission_granted_pre_download/# "Algolia")

![](https://docs.gravityforms.com/wp-content/plugins/wpfront-scroll-top/includes/assets/icons/1.png)