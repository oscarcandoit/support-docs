---
url: "https://docs.gravityforms.com/cancel-stripe-subscription-payments/"
title: "Cancel a Stripe Subscription in Gravity Forms"
---

[![Gravity Forms Documentation](https://docs.gravityforms.com/wp-content/uploads/2023/09/logo.svg)](https://docs.gravityforms.com/) [![Gravity Forms Documentation](https://docs.gravityforms.com/wp-content/uploads/2024/08/gf-print_logo.svg)](https://docs.gravityforms.com/)

- [User Guides](https://docs.gravityforms.com/category/user-guides/)
- [Developer](https://docs.gravityforms.com/category/developers/)
- [Blog](https://www.gravityforms.com/blog/)
- [Changelog](https://docs.gravityforms.com/gravityforms-change-log/)

```

```

Toggle Menu

- [Getting Started](https://docs.gravityforms.com/category/getting-started/)
- [Your Gravity Forms Account](https://docs.gravityforms.com/category/your-gravity-forms-account/)
- [User Guides](https://docs.gravityforms.com/category/user-guides/)
- [Gravity Forms 2.9](https://docs.gravityforms.com/category/gravity-forms-2-9/)
- [Gravity Forms 2.8](https://docs.gravityforms.com/category/gravity-forms-2-8/)
- [Add-Ons](https://docs.gravityforms.com/category/add-ons-gravity-forms/)
- [Developers](https://docs.gravityforms.com/category/developers/)  - [Theme Framework](https://docs.gravityforms.com/category/developers/theme-framework/)
  - [Hooks](https://docs.gravityforms.com/category/developers/hooks/)
  - [Data Objects](https://docs.gravityforms.com/category/developers/data-objects/)
  - [PHP API](https://docs.gravityforms.com/category/developers/php-api/)
  - [Database](https://docs.gravityforms.com/category/developers/database/)
  - [Developer Snippets](https://docs.gravityforms.com/category/developers/tutorials/)    - [Accessing Mapped Field Values During Feed Processing](https://docs.gravityforms.com/mapped-field-values-during-feed-processing/ "Accessing Mapped Field Values During Feed Processing")
    - [Add Sub-Pages to Gravity Forms Admin Navigation](https://docs.gravityforms.com/add-sub-pages-to-gravity-forms-admin-nav/ "Add Sub-Pages to Gravity Forms Admin Navigation")
    - [Adding a New Notification Service Using the Add-On Framework](https://docs.gravityforms.com/new-notification-service-using-framework/ "Adding a New Notification Service Using the Add-On Framework")
    - [Adding a Note to the Entry when Using the Add-On Framework](https://docs.gravityforms.com/adding-note-when-using-addon-framework/ "Adding a Note to the Entry when Using the Add-On Framework")
    - [Adding Meta Boxes to the Entry Detail Page Using the Add-On Framework](https://docs.gravityforms.com/meta-boxes-entry-detail-addon-framework/ "Adding Meta Boxes to the Entry Detail Page Using the Add-On Framework")
    - [Cancel a Stripe Subscription After a Specified Number of Payments](https://docs.gravityforms.com/cancel-stripe-subscription-payments/ "Cancel a Stripe Subscription After a Specified Number of Payments")
    - [Capturing the HTTP Referrer URL on Form Submissions](https://docs.gravityforms.com/capture-http-referrer-url-form-submissions/ "Capturing the HTTP Referrer URL on Form Submissions")
    - [Centering an Entire Form](https://docs.gravityforms.com/centering-an-entire-form/ "Centering an Entire Form")
    - [Changing Stripe Billing Information](https://docs.gravityforms.com/changing-stripe-billing-information/ "Changing Stripe Billing Information")
    - [Create a Customer in Stripe without Capturing Payment](https://docs.gravityforms.com/create-customer-stripe-without-payment/ "Create a Customer in Stripe without Capturing Payment")
    - [Create Post with Custom Taxonomy](https://docs.gravityforms.com/create-post-with-custom-taxonomy/ "Create Post with Custom Taxonomy")
    - [Defining Minimum Add-On Requirements](https://docs.gravityforms.com/defining-minimum-add-requirements/ "Defining Minimum Add-On Requirements")
    - [Deleting Cached Entry Data](https://docs.gravityforms.com/deleting-cached-entry-data/ "Deleting Cached Entry Data")
    - [Disabling Mobile Keyboard Input on Datepicker Fields](https://docs.gravityforms.com/disable-keyboard-input-datepicker-fields/ "Disabling Mobile Keyboard Input on Datepicker Fields")
    - [Display a message on the login form when the user is pending activation](https://docs.gravityforms.com/display-message-login-form-user-pending-activation/ "Display a message on the login form when the user is pending activation")
    - [Enable Use of the Total Field with Conditional Logic](https://docs.gravityforms.com/enable-total-field-with-conditional-logic/ "Enable Use of the Total Field with Conditional Logic")
    - [Hiding the Form Title](https://docs.gravityforms.com/hiding-the-form-title/ "Hiding the Form Title")
    - [Highlighting the Current or Future Date in the Datepicker](https://docs.gravityforms.com/highlighting-current-future-date-datepicker/ "Highlighting the Current or Future Date in the Datepicker")
    - [How to Add a Custom Field Group when Using the Field Framework](https://docs.gravityforms.com/add-custom-field-group-using-field-framework/ "How to Add a Custom Field Group when Using the Field Framework")
    - [How to Add a New Field to an Existing Form Using the GFAPI](https://docs.gravityforms.com/how-to-add-field-to-form-using-gfapi/ "How to Add a New Field to an Existing Form Using the GFAPI")
    - [How To Add And Remove Countries From the Address Field](https://docs.gravityforms.com/addremove-countries-country-select-field/ "How To Add And Remove Countries From the Address Field")
    - [How to Add Delayed Payment Support to a Feed Add-On](https://docs.gravityforms.com/add-delayed-payment-support-feed-add/ "How to Add Delayed Payment Support to a Feed Add-On")
    - [How to Set the Default Properties for a New Field](https://docs.gravityforms.com/set-default-properties-new-field/ "How to Set the Default Properties for a New Field")
    - [Including a New Field Using the Add-On Framework](https://docs.gravityforms.com/including-new-field-using-add-on-framework/ "Including a New Field Using the Add-On Framework")
    - [Including and Using Entry Meta with the Add-On Framework](https://docs.gravityforms.com/using-entry-meta-with-add-on-framework/ "Including and Using Entry Meta with the Add-On Framework")
    - [Including Scripts and Styles when Using the Add-On Framework](https://docs.gravityforms.com/include-scripts-styles-with-addon-framework/ "Including Scripts and Styles when Using the Add-On Framework")
    - [Sending Notifications on Custom Events when Using the Add-On Framework](https://docs.gravityforms.com/notifications-custom-events-addon-framework/ "Sending Notifications on Custom Events when Using the Add-On Framework")
    - [Using EDD Software Licensing with the Add-On Framework](https://docs.gravityforms.com/edd-software-licensing-add-on-framework/ "Using EDD Software Licensing with the Add-On Framework")
  - [REST API](https://docs.gravityforms.com/category/developers/rest-api/)
- [Knowledge Base](https://docs.gravityforms.com/category/knowledge-base/)

# Cancel a Stripe Subscription After a Specified Number of Payments

- [Placement](https://docs.gravityforms.com/cancel-stripe-subscription-payments/#h-placement)

The Stripe API doesn’t allow you to set the total number of recurrences of a payment when creating the subscription but it is possible to cancel the subscription via the gform\_post\_add\_subscription\_payment hook which runs after a payment is recorded.

The Stripe API now supports specifying an end date for when subscriptions should automatically cancel. This can be set using the [gform\_stripe\_subscription\_params\_pre\_update\_customer](https://docs.gravityforms.com/gform_stripe_subscription_params_pre_update_customer/#cancel-at-specified-date-time) filter.

**Note:** If you delete the entry associated to the subscription this snippet will not work.

|     |     |
| --- | --- |
| 1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32 | `add_action(``'gform_post_add_subscription_payment'``,``function``(``$entry``) {`<br>```gf_stripe()->log_debug(``'gform_post_add_subscription_payment: Running...'``);`<br>```if``( rgar(``$entry``,``'payment_status'``) !==``'Active'``) {`<br>```// Abort if this event isn't for an active subscription.`<br>```return``;`<br>```}`<br>```// Get the feed that processed the entry.`<br>```$feed``= gf_stripe()->get_payment_feed(``$entry``);`<br>```$feed_name``= rgars(``$feed``,``'meta/feedName'``);`<br>```gf_stripe()->log_debug(``'gform_post_add_subscription_payment: Feed: '``.``$feed_name``.``'; Entry: '``.``$entry``[``'id'``] );`<br>```// Define the names of the feeds you want this code to cancel subscriptions for.`<br>```$feed_names``=``array``(``'feed name one'``,``'feed name two'``);`<br>```if``( ! in_array(``$feed_name``,``$feed_names``) ) {`<br>```// Abort if the entry was processed by a different feed.`<br>```return``;`<br>```}`<br>```// Get the payment count from the database.`<br>```global``$wpdb``;`<br>```$count``=``$wpdb``->get_var(``$wpdb``->prepare(``"SELECT count(id) FROM {$wpdb->prefix}gf_addon_payment_transaction WHERE lead_id=%d"``,``$entry``[``'id'``] ) );`<br>```gf_stripe()->log_debug(``'gform_post_add_subscription_payment: $count = '``. print_r(``$count``, true ) );`<br>```if``(``$count``>= 3 ) {``// Update this line to the Total number of payments including the first one.`<br>```$result``= gf_stripe()->cancel(``$entry``,``$feed``);`<br>```gf_stripe()->log_debug(``"gform_post_add_subscription_payment: Cancelling subscription (feed #{$feed['id']} - {$feed_name}) for entry #{$entry['id']}. Result: "``. print_r(``$result``, 1 ) );`<br>```}`<br>`} );` |

The [gform\_post\_add\_subscription\_payment](https://docs.gravityforms.com/gform_post_add_subscription_payment) is an action hook which is called after the Stripe webhook notifies your site that a payment has been made for the subscription and the add-on has recorded the transaction and added a note to the entry.

Because it runs for all forms with a subscription feed we need to tell it only to run for the correct feed, we do this by specifying the feed names in the array on this line:

|     |     |
| --- | --- |
| 1 | `$feed_names``=``array``(``'feed name one'``,``'feed name two'``);` |

You would then update the following line with the number of payments you want to allow:

|     |     |
| --- | --- |
| 1 | `if``(``$count``>= 3 ) {` |

If the count retrieved from the database query matches the value you specify the cancel method will be called which will notify Stripe that the subscription for that customer should be canceled.

Stripe will then notify your site when that action has been completed and the status on the entry will update to canceled and a note will be added indicating the date it was canceled.

## Placement

This code can be used in the [functions.php](https://developer.wordpress.org/themes/basics/theme-functions/) file of the active theme, a custom functions plugin, a custom add-on, or with a code snippets plugin.

See also the PHP section in this article: [Where Do I Put This Code?](https://docs.gravityforms.com/where-do-i-put-this-code/)

- X/Twitter


This field is for validation purposes and should be left unchanged.

- Was this article helpful?

- How we can improve it?

- Please [open a support ticket](https://www.gravityforms.com/open-support-ticket/) if you need technical support or want to report a bug. Product feedback, feature and integration requests, and other functionality ideas can be submitted on our [Product Roadmap page](https://www.gravityforms.com/gravity-forms-roadmap/?c=submit-idea).


Δ

Last modified: March 13, 2023

© Copyright 2008 - 2025 Rocketgenius, Inc

[Return to Gravity Forms](https://www.gravityforms.com/)

Notifications

[Algolia](https://docs.gravityforms.com/cancel-stripe-subscription-payments/# "Algolia")

![](https://docs.gravityforms.com/wp-content/plugins/wpfront-scroll-top/includes/assets/icons/1.png)